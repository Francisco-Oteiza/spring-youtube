<main class="page">
  <section class="shell">
    <!-- Logo / header -->
    <header class="header">
      <div class="logo">
        <div class="logo-badge">▶</div>
        <div class="logo-text">{{ logoText }}</div>
      </div>
      <div class="sub">Create users and manage them (front-first demo)</div>
    </header>

    <!-- Form -->
    <section class="card">
      <h1>Create user</h1>

      <div class="form">
        <label>
          <span>Username</span>
          <input
            [value]="username()"
            (input)="username.set(($any($event.target)).value)"
            placeholder="e.g. youtube"
            [class.invalid]="!!usernameError()"
          />
          @if (usernameError()) {
            <small class="hint error">{{ usernameError() }}</small>
          }
        </label>

        <label>
          <span>Email</span>
          <input
            [value]="email()"
            (input)="email.set(($any($event.target)).value)"
            placeholder="e.g. youtube@demo.com"
            [class.invalid]="!!emailError()"
          />
          @if (emailError()) {
            <small class="hint error">{{ emailError() }}</small>
          }
        </label>

        <div class="actions">
          <button class="btn" (click)="save()" [disabled]="!canSave()">
            {{ loading() ? 'Saving…' : 'Save' }}
          </button>

          <button class="btn ghost" (click)="refresh()" [disabled]="loading()">
            Refresh
          </button>
        </div>

        @if (error()) {
          <p class="banner error">{{ error() }}</p>
        }
      </div>
    </section>

    <!-- Table -->
    <section class="card">
      <div class="table-head">
        <h2>Users</h2>
        <div class="count">{{ users().length }} total</div>
      </div>

      @if (users().length) {
        <div class="table-wrap">
          <table class="table">
            <thead>
              <tr>
                <th class="col-id">ID</th>
                <th>Username</th>
                <th>Email</th>
                <th class="col-actions"></th>
              </tr>
            </thead>

            <tbody>
              @for (u of users(); track u.id) {
                <tr>
                  <td class="muted">{{ u.id }}</td>

                  <td>
                    @if (editingId() === u.id) {
                      <div class="edit-wrap">
                        <input
                          class="inline-input"
                          [value]="editUsername()"
                          (input)="editUsername.set(($any($event.target)).value)"
                          (keydown.enter)="confirmEdit()"
                          (keydown.escape)="cancelEdit()"
                          [disabled]="loading()"
                          autofocus
                        />
                      </div>
                    } @else {
                      {{ u.username }}
                    }
                  </td>

                  <td class="muted">{{ u.email }}</td>

                  <td class="actions-cell">
                    <div class="row-actions">
                      @if (editingId() !== u.id) {
                        <!-- Edit -->
                        <button
                          class="icon-btn warn"
                          title="Edit username"
                          (click)="startEdit(u)"
                          [disabled]="loading()"
                        >
                          <svg viewBox="0 0 24 24" aria-hidden="true">
                            <path
                              d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25Zm2.92 2.83H5v-.92l8.06-8.06.92.92L5.92 20.08ZM20.71 7.04a1 1 0 0 0 0-1.41l-2.34-2.34a1 1 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83Z"
                            />
                          </svg>
                        </button>

                        <!-- Delete -->
                        <button
                          class="icon-btn danger"
                          title="Delete"
                          (click)="remove(u.id)"
                          [disabled]="loading()"
                        >
                          <svg viewBox="0 0 24 24" aria-hidden="true">
                            <path
                              d="M9 3h6l1 2h4v2H4V5h4l1-2Zm1 6h2v10h-2V9Zm4 0h2v10h-2V9ZM7 9h2v10H7V9Zm1 12h8a2 2 0 0 0 2-2V7H6v12a2 2 0 0 0 2 2Z"
                            />
                          </svg>
                        </button>
                      } @else {
                        <!-- Save -->
                        <button
                          class="icon-btn ok"
                          title="Save"
                          (click)="confirmEdit()"
                          [disabled]="loading() || !canConfirmEdit()"
                        >
                          <svg viewBox="0 0 24 24" aria-hidden="true">
                            <path
                              d="M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"
                            />
                          </svg>
                        </button>

                        <!-- Cancel -->
                        <button
                          class="icon-btn cancel"
                          title="Cancel"
                          (click)="cancelEdit()"
                          [disabled]="loading()"
                        >
                          <svg viewBox="0 0 24 24" aria-hidden="true">
                            <path
                              d="M18.3 5.71 12 12l6.3 6.29-1.41 1.42L12 13.41l-6.89 6.3-1.42-1.42L10.59 12 3.69 5.71 5.11 4.29 12 10.59l6.89-6.3z"
                            />
                          </svg>
                        </button>
                      }
                    </div>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      } @else {
        <div class="empty">
          <div class="empty-title">No users yet</div>
          <div class="empty-sub">Create one using the form above.</div>
        </div>
      }
    </section>
  </section>
</main>
